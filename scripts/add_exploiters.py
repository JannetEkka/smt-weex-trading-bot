# add_exploiters.py
import pandas as pd
import glob

# Load current filtered whales
filtered = pd.read_csv("data/top_whales_filtered.csv")
print(f"Current filtered: {len(filtered)}")
print(filtered['category'].value_counts())

# Load all balances
balance_files = glob.glob("data/whale_balances_*.csv")
latest = max(balance_files)
balances = pd.read_csv(latest)

# Get Exploiters with >0.1 ETH (lower threshold)
exploiters = balances[(balances['category'] == 'Exploiter') & (balances['balance_eth'] > 0.1)]
print(f"\nExploiters with >0.1 ETH: {len(exploiters)}")

# Add exploiters not already in filtered
existing_addresses = set(filtered['address'].str.lower())
new_exploiters = exploiters[~exploiters['address'].str.lower().isin(existing_addresses)]
print(f"New exploiters to add: {len(new_exploiters)}")

# Combine
combined = pd.concat([filtered, new_exploiters], ignore_index=True)
combined.to_csv("data/top_whales_filtered.csv", index=False)
print(f"\nUpdated filtered whales: {len(combined)}")
print(combined['category'].value_counts())